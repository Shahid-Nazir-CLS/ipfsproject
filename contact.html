<!DOCTYPE html>

<html lang="en" class="no-js">
    <!-- BEGIN HEAD -->
    <head>
        <meta charset="utf-8"/>
        <title>Crypto Vote</title>

        <!-- GLOBAL MANDATORY STYLES -->

        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        
        <!-- Web3 Library -->
        <script src="js/web3.min.js"></script>

        
        <!-- THEME STYLES -->
        <link href="css/layout.min.css" rel="stylesheet" type="text/css"/>

    </head>
    <!-- END HEAD -->

    <!-- BODY -->
    <body>

        <!--========== HEADER ==========-->
        <header class="header navbar-fixed-top">
            <!-- Navbar -->
            <nav class="navbar" role="navigation">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="menu-container">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="toggle-icon"></span>
                        </button>

                        <!-- Logo -->
                        <div class="logo">
                            <a class="logo-wrap" href="index.html">
                                <img class="logo-img logo-img-main" src="img/logo.png" alt="Asentus Logo">
                                <img class="logo-img logo-img-active" src="img/logo-dark.png" alt="Asentus Logo">
                            </a>
                        </div>
                        <!-- End Logo -->
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse nav-collapse">
                        <div class="menu-container">
                            <ul class="navbar-nav navbar-nav-right">
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="index.html">Home</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="election.html">Election</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="prevElections.html">Previous Election</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="about.html">Team</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="contact.html">Contact</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover active" href="#" id="adminbtn">Admin</a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- End Navbar Collapse -->
                </div>
            </nav>
            <!-- Navbar -->
        </header>
        <!--========== END HEADER ==========-->

        <!--========== FOOTER ==========-->
        <footer class="footer">
            <!-- Links -->
            <div class="footer-seperator">
                <div class="content-lg container">
                    <div class="row">
                        
                        <div class="col-sm-5 sm-margin-b-30">
                            <!-- <div class="parallax-content container"> -->
                                <h1 class="carousel-title">Contact</h1>
                                <p>If you have any questions or concerns or if you want to hold an election please feel free to contact us.</p>
                            <!-- </div> -->
                            <h2 class="color-white">Send Us A Note</h2>

                            <form action="//submit.form" id="ContactUs100" method="post" onsubmit="return ValidateForm(this);">
                                <script type="text/javascript">
                                    function ValidateForm(frm) {
                                    if (frm.Name.value == "") { alert('Name is required.'); frm.Name.focus(); return false; }
                                    if (frm.PhoneNumber.value == "") { alert('PhoneNumber is required.'); frm.PhoneNumber.focus(); return false; }
                                    if (frm.Subject.value == "") { alert('Subject is required.'); frm.Subject.focus(); return false; }
                                    if (frm.Comments.value == "") { alert('Please enter comments or questions as mail body.'); frm.Comments.focus(); return false; }

                                    var link = "mailto:shahiddroid@gmail.com"
                                    + "?cc=muntazirshafi8@gmail.com"
                                    + "&subject=" + escape(frm.Subject.value)
                                    + "&body=" + escape("Name : "+frm.Name.value+"\nPhone Number : "+frm.PhoneNumber.value+"\n"+frm.Comments.value)
                                    ;

                                    window.location.href = link;

                                    return false;}
                                </script>
                                <table style="width:550px;border:0;" cellpadding="8" cellspacing="0" id="contactTable">
                                    <tr> <td>
                                    <label for="Name">Name*:</label>
                                    </td> <td>
                                    <input name="Name" type="text" maxlength="60" style="width:350px;" />
                                    </td> </tr> <tr> <td>
                                    <label for="PhoneNumber">Phone number:</label>
                                    </td> <td>
                                    <input name="PhoneNumber" type="text" maxlength="43" style="width:350px;" />
                                    </td> </tr> <tr> <td>
                                    <label for="Subject">Subject:</label>
                                    </td> <td>
                                    <input name="Subject" type="text" maxlength="90" style="width:350px;" />
                                    </td> </tr> <tr> <td>
                                    <label for="Comments">Message:</label>
                                    </td> <td>
                                    <textarea name="Comments" rows="7" cols="40" style="width:350px;"></textarea>
                                    </td> </tr> <tr> <td>
                                    
                                    </td> <td>
                                    <input name="skip_Submit" type="submit" value="Submit" id="sendmail"/>
                                    
                                    </td> </tr>
                                </table>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- End Links -->

            <!-- Copyright -->
            <div class="content container">
                <div class="row">
                    <div class="col-xs-6">
                        <img class="footer-logo" src="img/logo.png" alt="Asentus Logo">
                    </div>
                    <div class="col-xs-6 text-right">
                        <p style="color:white">Â© Crypto Vote 2018-2019<p>
                    </div>
                </div>
                <!--// end row -->
            </div>
            <!-- End Copyright -->
        </footer>
        <!--========== END FOOTER ==========-->


        <!-- JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
        <!-- CORE PLUGINS -->
        <script src="vendor/jquery.min.js" type="text/javascript"></script>
        <script src="vendor/jquery-migrate.min.js" type="text/javascript"></script>
        <script src="vendor/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

        <!-- PAGE LEVEL SCRIPTS -->
        <script src="js/layout.min.js" type="text/javascript"></script>

        <!-- Web3 controls
        Communicating with smart contract -->

        <script>

            // If web3 is not undefined, then we'll use that as our provider. 
            // If it's undefined (else), we can manually specify the provider ourselves. 
            if (typeof web3 !== 'undefined') {
                web3 = new Web3(web3.currentProvider);
            } else {
                // set the provider you want from Web3.providers
                web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
            }

            // We have to specify a default ethereum account to use 
            // through the web3.eth.defaultAccount method:
            web3.eth.defaultAccount = web3.eth.accounts[0];

            //  Set up the contract ABI so the app knows what functions are available for this contract.
            // This ABI allows you to call functions and receive data from your smart contract.
            var VotesContract = web3.eth.contract([
    {
        "constant": false,
        "inputs": [],
        "name": "abstain",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_candidateName",
                "type": "string"
            },
            {
                "name": "_symbol",
                "type": "string"
            }
        ],
        "name": "addCandidate",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "pubkey",
                "type": "address"
            }
        ],
        "name": "addVoter",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "msg",
                "type": "bytes32"
            },
            {
                "name": "sign",
                "type": "bytes"
            }
        ],
        "name": "checkOwner",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "msg",
                "type": "bytes32"
            },
            {
                "name": "sign",
                "type": "bytes"
            }
        ],
        "name": "checkPass",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_candidateName",
                "type": "string"
            }
        ],
        "name": "removeCandidate",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [],
        "name": "resetCandidates",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_electionName",
                "type": "string"
            },
            {
                "name": "_duration",
                "type": "string"
            }
        ],
        "name": "setElectionParameters",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_electionStartTime",
                "type": "string"
            }
        ],
        "name": "setElectionStartTime",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_cand",
                "type": "string"
            }
        ],
        "name": "vote",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "anonymous": false,
        "inputs": [],
        "name": "VoteEvent",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "valid",
                "type": "string"
            }
        ],
        "name": "PassEvent",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "validowner",
                "type": "string"
            }
        ],
        "name": "PassEventOwner",
        "type": "event"
    },
    {
        "inputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "constructor"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getCandCount",
        "outputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "_id",
                "type": "uint256"
            }
        ],
        "name": "getCandidate",
        "outputs": [
            {
                "name": "",
                "type": "string"
            },
            {
                "name": "",
                "type": "string"
            },
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getCount",
        "outputs": [
            {
                "name": "",
                "type": "uint256[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getElectionParameters",
        "outputs": [
            {
                "name": "",
                "type": "string"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getElectionTime",
        "outputs": [
            {
                "name": "",
                "type": "string"
            },
            {
                "name": "",
                "type": "string"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getNonce",
        "outputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getOwner",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getvoters",
        "outputs": [
            {
                "name": "",
                "type": "address[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "message",
                "type": "bytes32"
            },
            {
                "name": "sig",
                "type": "bytes"
            }
        ],
        "name": "recoverSigner",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "pure",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "name": "voterpubkeys",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }
]);


            // Set up the address of the contract with MyContract.at().
            // The important thing to know is that MyContract.at() returns the instance.
            var Votes = VotesContract.at('0x38830a02c576cd266cd191d2d1d9148560b8026b');
            var votesEvent = Votes.VoteEvent();
            var passEventOwner = Votes.PassEventOwner();

            
            // time admin controls


            Votes.getElectionTime((err, res) => {
                   if (!err) {
                        
                        // disbale admin controls
                        


                        var d = new Date(res[0]);


                        var c = new Date();

                        var diff = (Math.floor(c.getTime() / 1000) - (d.getTime() / 1000));

                        var rem = (60 * res[1]) - diff;



                        var seconds = rem;
 

                         var x = setInterval(function() {
                            
                            
                            // If the count down is over, write some text 
                            // election is running
                            
                             if(seconds > 0){

                             }else if(seconds < 0  && seconds > -2){
                                window.location.reload();
                             }
                            seconds--;
                        }, 500);
                    }else{
                        console.log(err);
                    }
                });



            $("#adminbtn").click(function() {

                    
                Votes.getElectionTime((err, res) => {
                   if (!err) {
                        
                        // disbale admin controls
                        


                        var d = new Date(res[0]);


                        var c = new Date();

                        var diff = (Math.floor(c.getTime() / 1000) - (d.getTime() / 1000));

                        var rem = (60 * res[1]) - diff;



                        var seconds = rem;

                        if (seconds > 0) {
                                document.getElementById("adminbtn").setAttribute('href', "#");

                            }else{
                                

                                // election not running or is over
                                Votes.getNonce((err, res) => {
                                   if (err) {
                                       console.log(err);
                                   }else{
                                        var msg = prompt("Enter any text to verify that you are admin.");

                                        var original_message = msg+": "+res;
                                        var message_hash = web3.sha3(
                                            "\u0019Ethereum Signed Message:\n" +
                                            original_message.length.toString() +
                                            original_message
                                        );

                                        console.log(message_hash);
                                        web3.personal.sign(web3.fromAscii(original_message), web3.eth.coinbase, function(err, result) {
                                            if (err){
                                                console.error(err);  
                                            }else{

                                                signature = result;

                                                Votes.checkOwner(message_hash, signature , (err, response) => {
                                                    if (err) {
                                                        console.log(err);
                                                    }
                                                });

                                                console.log("Signature : "+result);
                                            }
                                        });

                                        

                                   }
                                });

                            }
                       

                   }else
                    console.log(err);
                });



            });



            passEventOwner.watch(function(err, res){
                if(!err){
                    if(res.args.validowner == "true"){

                        window.location.href = "admin.html";
                        
                    }else{
                        alert("You are not allowed to enter admin section.")
                    }
                }else{
                    console.log(err);
                }
            });

        </script>

    </body>
    <!-- END BODY -->
</html>