<!DOCTYPE html>

<html lang="en" class="no-js">
    <!-- BEGIN HEAD -->
    <head>
        <meta charset="utf-8"/>
        <title>Crypto Vote</title>

        <!-- GLOBAL MANDATORY STYLES -->

        <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        
        <!-- Web3 Library -->
        <script src="js/web3.min.js"></script>

        
        <!-- THEME STYLES -->
        <link href="css/layout.min.css" rel="stylesheet" type="text/css"/>

    </head>
    <!-- END HEAD -->

    <!-- BODY -->
    <body background="img/1920x1080/04.jpg">

        <!--========== HEADER ==========-->
        <header class="header navbar-fixed-top">
            <!-- Navbar -->
            <nav class="navbar" role="navigation">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="menu-container">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="toggle-icon"></span>
                        </button>

                        <!-- Logo -->
                        <div class="logo">
                            <a class="logo-wrap" href="index.html">
                                <img class="logo-img logo-img-main" src="img/logo.png" alt="Asentus Logo">
                                <img class="logo-img logo-img-active" src="img/logo-dark.png" alt="Asentus Logo">
                            </a>
                        </div>
                        <!-- End Logo -->
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse nav-collapse">
                        <div class="menu-container">
                            <ul class="navbar-nav navbar-nav-right">
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="index.html">Home</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="election.html">Election</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="prevElections.html">Previous Election</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="about.html">Team</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover" href="contact.html">Contact</a></li>
                                <li class="nav-item"><a class="nav-item-child nav-item-hover active" href="#" id="adminbtn">Admin</a></li>
                            </ul>
                        </div>
                    </div>
                    <!-- End Navbar Collapse -->
                </div>
            </nav>
            <!-- Navbar -->
        </header>
        
        <!-- Team -->
            <div class="content-lg container">
                <div class="row margin-b-40">
                    <div class="col-sm-6">
                        <h2>Meet the Team</h2>
                    </div>
                </div>

                <div class="row">
                    <!-- Team -->
                    <div class="col-sm-4 sm-margin-b-50">
                        <div class="bg-color-white margin-b-20">
                            <div class="wow zoomIn" data-wow-duration=".3" data-wow-delay=".1s">
                                <img class="img-responsive" src="img/770x860/01.jpg" alt="Team Image">
                            </div>
                        </div>
                        <h4>Shahid Nazir <span class="text-uppercase margin-l-20"> <br>
                            Student  <br>
                            shahiddroid@gmail.com<br>
                            Contact : +91 8491966861<br>
                            Roll No : CS-14-25<BR>
                            Registration No : IUST/BTECH/14/1936</span>
                        </h4>
                    </div>
                    <!-- End Team -->

                    <!-- Team -->
                    <div class="col-sm-4 sm-margin-b-50">
                        <div class="bg-color-white margin-b-20">
                            <div class="wow zoomIn" data-wow-duration=".3" data-wow-delay=".1s">
                                <img class="img-responsive" src="img/770x860/02.jpg" alt="Team Image">
                            </div>
                        </div>
                        <h4>Muntazir Shafi <span class="text-uppercase margin-l-20"> <br>
                            Student  <br>
                            muntazirshafi8@gmail.com<br>
                            Contact : +91 9797959389<br>
                            Roll No : CS-14-13<BR>
                            Registration No : IUST/BTECH/14/1969</span>
                        </h4>
                    </div>
                    <!-- End Team -->

                    <!-- Team -->
                    <div class="col-sm-4 sm-margin-b-50">
                        <div class="bg-color-white margin-b-20">
                            <div class="wow zoomIn" data-wow-duration=".3" data-wow-delay=".1s">
                                <img class="img-responsive" src="img/770x860/03.jpg" alt="Team Image">
                            </div>
                        </div>
                        <h4>Zahid Maqsood  <span class="text-uppercase margin-l-20"> <br>
                            Student  <br>
                            zahidmaqsoodoo4@gmail.com<br>
                            Contact : +91 7051243848<br>
                            Roll No : CS-14-34<BR>
                            Registration No : IUST/BTECH/14/1939</span>
                        </h4>                  
                    </div>
                    <!-- End Team -->

                </div>
            </div>
        <!-- End Team -->

        
            <!-- Copyright -->
            <div class="content container">
                <div class="row">
                    <div class="col-xs-6">
                        <img class="footer-logo" src="img/logo.png" alt="Asentus Logo">
                    </div>
                    <div class="col-xs-6 text-right">
                        <p style="color:white">Â© Crypto Vote 2018-2019<p>
                    </div>
                </div>
                <!--// end row -->
            </div>
            <!-- End Copyright -->

        <!-- Back To Top -->

        <!-- JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
        <!-- CORE PLUGINS -->
        <script src="vendor/jquery.min.js" type="text/javascript"></script>
        <script src="vendor/jquery-migrate.min.js" type="text/javascript"></script>
        <script src="vendor/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

        <!-- PAGE LEVEL SCRIPTS -->
        <script src="js/layout.min.js" type="text/javascript"></script>

        <!-- Web3 controls
        Communicating with smart contract -->

        <script>

            // If web3 is not undefined, then we'll use that as our provider. 
            // If it's undefined (else), we can manually specify the provider ourselves. 
            if (typeof web3 !== 'undefined') {
                web3 = new Web3(web3.currentProvider);
            } else {
                // set the provider you want from Web3.providers
                web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
            }

            // We have to specify a default ethereum account to use 
            // through the web3.eth.defaultAccount method:
            web3.eth.defaultAccount = web3.eth.accounts[0];

            //  Set up the contract ABI so the app knows what functions are available for this contract.
            // This ABI allows you to call functions and receive data from your smart contract.
            var VotesContract = web3.eth.contract([
    {
        "constant": false,
        "inputs": [],
        "name": "abstain",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_candidateName",
                "type": "string"
            },
            {
                "name": "_symbol",
                "type": "string"
            }
        ],
        "name": "addCandidate",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "pubkey",
                "type": "address"
            }
        ],
        "name": "addVoter",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "msg",
                "type": "bytes32"
            },
            {
                "name": "sign",
                "type": "bytes"
            }
        ],
        "name": "checkOwner",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "msg",
                "type": "bytes32"
            },
            {
                "name": "sign",
                "type": "bytes"
            }
        ],
        "name": "checkPass",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_candidateName",
                "type": "string"
            }
        ],
        "name": "removeCandidate",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [],
        "name": "resetCandidates",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_electionName",
                "type": "string"
            },
            {
                "name": "_duration",
                "type": "string"
            }
        ],
        "name": "setElectionParameters",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_electionStartTime",
                "type": "string"
            }
        ],
        "name": "setElectionStartTime",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "constant": false,
        "inputs": [
            {
                "name": "_cand",
                "type": "string"
            }
        ],
        "name": "vote",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    },
    {
        "anonymous": false,
        "inputs": [],
        "name": "VoteEvent",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "valid",
                "type": "string"
            }
        ],
        "name": "PassEvent",
        "type": "event"
    },
    {
        "anonymous": false,
        "inputs": [
            {
                "indexed": false,
                "name": "validowner",
                "type": "string"
            }
        ],
        "name": "PassEventOwner",
        "type": "event"
    },
    {
        "inputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "constructor"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getCandCount",
        "outputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "_id",
                "type": "uint256"
            }
        ],
        "name": "getCandidate",
        "outputs": [
            {
                "name": "",
                "type": "string"
            },
            {
                "name": "",
                "type": "string"
            },
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getCount",
        "outputs": [
            {
                "name": "",
                "type": "uint256[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getElectionParameters",
        "outputs": [
            {
                "name": "",
                "type": "string"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getElectionTime",
        "outputs": [
            {
                "name": "",
                "type": "string"
            },
            {
                "name": "",
                "type": "string"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getNonce",
        "outputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getOwner",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [],
        "name": "getvoters",
        "outputs": [
            {
                "name": "",
                "type": "address[]"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "message",
                "type": "bytes32"
            },
            {
                "name": "sig",
                "type": "bytes"
            }
        ],
        "name": "recoverSigner",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "pure",
        "type": "function"
    },
    {
        "constant": true,
        "inputs": [
            {
                "name": "",
                "type": "uint256"
            }
        ],
        "name": "voterpubkeys",
        "outputs": [
            {
                "name": "",
                "type": "address"
            }
        ],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }
]);


            // Set up the address of the contract with MyContract.at().
            // The important thing to know is that MyContract.at() returns the instance.
            var Votes = VotesContract.at('0x38830a02c576cd266cd191d2d1d9148560b8026b');
            var votesEvent = Votes.VoteEvent();
            var passEventOwner = Votes.PassEventOwner();

            
            // time admin controls


            Votes.getElectionTime((err, res) => {
                   if (!err) {
                        
                        // disbale admin controls
                        


                        var d = new Date(res[0]);


                        var c = new Date();

                        var diff = (Math.floor(c.getTime() / 1000) - (d.getTime() / 1000));

                        var rem = (60 * res[1]) - diff;



                        var seconds = rem;


                         var x = setInterval(function() {
                            
                            
                            // If the count down is over, write some text 
                            // election is running
                            
                             if(seconds > 0){

                             }else if(seconds < 0  && seconds > -2){
                                window.location.reload();
                             }
                            seconds--;
                        }, 500);
                    }else{
                        console.log(err);
                    }
                });



            $("#adminbtn").click(function() {

                    
                Votes.getElectionTime((err, res) => {
                   if (!err) {
                        
                        // disbale admin controls
                        


                        var d = new Date(res[0]);


                        var c = new Date();

                        var diff = (Math.floor(c.getTime() / 1000) - (d.getTime() / 1000));

                        var rem = (60 * res[1]) - diff;



                        var seconds = rem;

                        if (seconds > 0) {
                                document.getElementById("adminbtn").setAttribute('href', "#");

                            }else{
                                

                                // election not running or is over
                                Votes.getNonce((err, res) => {
                                   if (err) {
                                       console.log(err);
                                   }else{
                                        var msg = prompt("Enter any text to verify that you are admin.");

                                        var original_message = msg+": "+res;
                                        var message_hash = web3.sha3(
                                            "\u0019Ethereum Signed Message:\n" +
                                            original_message.length.toString() +
                                            original_message
                                        );

                                        console.log(message_hash);
                                        web3.personal.sign(web3.fromAscii(original_message), web3.eth.coinbase, function(err, result) {
                                            if (err){
                                                console.error(err);  
                                            }else{

                                                signature = result;

                                                Votes.checkOwner(message_hash, signature , (err, response) => {
                                                    if (err) {
                                                        console.log(err);
                                                    }
                                                });

                                                console.log("Signature : "+result);
                                            }
                                        });

                                        

                                   }
                                });

                            }
                       

                   }else
                    console.log(err);
                });



            });



            passEventOwner.watch(function(err, res){
                if(!err){
                    if(res.args.validowner == "true"){

                        window.location.href = "admin.html";
                        
                    }else{
                        alert("You are not allowed to enter admin section.")
                    }
                }else{
                    console.log(err);
                }
            });


        </script>

    </body>
    <!-- END BODY -->
</html>